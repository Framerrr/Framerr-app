# v1.2.0

**Status:** RELEASED - 2025-12-17

---

## Features

- **Toast Notification System**: Added success/error/warning/info toast notifications throughout the app
- **Success Notifications**: All user actions (save, create, edit, delete) now show success toasts
- **Login/Logout Notifications**: Added "Welcome!" toast on login, "Goodbye!" toast on logout (WIP)
- **Session Expiry Notifications**: 401 errors now show "Session Expired" toast (excluding auth endpoints)
- **Edit Mode Disclaimer**: Dismissible disclaimer in edit mode explaining tablet/desktop only editing (server-side persistence)
- **Layout Controller System**: Centralized responsive layout control via React Context for consistent breakpoint behavior
- **Integrations Settings**: Restructured Widgets tab to Integrations with user access:
  - Widget Gallery and Active Widgets now accessible to all users (not just admin)
  - Service Settings (API keys, URLs) remain admin-only
  - New "My Linked Accounts" tab for users to link Overseerr username for notifications
- **Integration Notification Settings UI**: Complete settings UI for webhook notification control
  - Admin view: "Admin Receives" and "Users Can Receive" event dropdowns per integration
  - User view: "Notify Me When" dropdown showing only admin-allowed events
  - Webhook URL display with copy button and token generation
  - Configurable Webhook Base URL for Docker internal networking (Save/Reset buttons)
  - "Receive unmatched alerts" toggle for admins
  - Card visibility logic: Users only see integrations that are shared AND have allowed events
  - 36 event types defined: Overseerr (10), Sonarr (13), Radarr (13)
- **Webhook Backend Infrastructure**: Complete webhook receiver for external integrations
  - POST `/api/webhooks/overseerr/:token` - Receive Overseerr webhooks
  - POST `/api/webhooks/sonarr/:token` - Receive Sonarr webhooks
  - POST `/api/webhooks/radarr/:token` - Receive Radarr webhooks
  - Token-based authentication via URL (no additional headers needed)
  - Event type mapping from external services to Framerr events
  - User resolution cascade: manual link â†’ Plex SSO â†’ username match â†’ admin fallback
  - Test webhook handling with automatic admin notification
- **Real-Time Notifications via SSE**: Server-Sent Events for instant notification delivery
  - GET `/api/notifications/stream` - SSE endpoint for authenticated users
  - Automatic connection when user logs in
  - Toast + notification center update without page refresh
  - Heartbeat to keep connections alive
  - Clean reconnection on disconnect
- **Web Push Notifications**: Background push notifications when browser tab is closed
  - Service Worker (`public/sw.js`) for receiving push events
  - Selective routing: SSE when tab open, Web Push when closed
  - Per-device subscription (multiple devices supported)
  - Auto-cleanup of expired/invalid subscriptions
  - Test Push button in Settings for verification
  - Device list with "last used" timestamps and remove functionality
  - Auto-detects device name (e.g., "Chrome on Windows")
  - **Safari/iOS Support**: Full compatibility with Safari 16+ and iOS 16.4+ PWAs
  - Simplified per-device Enable/Disable toggle button
  - **Global Admin Toggle**: System-wide enable/disable for Web Push
    - Admin-only toggle in Web Push section header
    - When disabled: section hidden for users, push delivery blocked, subscriptions blocked
    - Persisted in systemConfig as `webPushEnabled`
- **System Icons for Notifications**: Integration logos auto-attached to webhook notifications
  - 9 system icons seeded on startup: Overseerr, Sonarr, Radarr, Plex, Jellyfin, Emby, Tautulli, qBittorrent, SABnzbd
  - Toast and Notification Center display custom icons for integration notifications
  - System icons protected from deletion (API returns 403, UI hides delete button)
  - IconPicker shows system icons with non-deletable indication
- **Seerr/Jellyseerr Support**: Human-readable event names now mapped for Seerr forks
- **Normalized Notification Format**: Professional `{AppName}: {Action}` title format
  - Human-readable messages (e.g., "Season 2 Episode 1" instead of "S2E1")
  - Quality included for grab/upgrade events
- **Event-Based Notification Routing**: Smart routing based on event type
  - Admin events (Request Pending, Issues) â†’ Admins
  - User events (Approved, Available, Declined) â†’ Requesting user
  - Failed events â†’ Both user and admins
- **Actionable Notifications (Overseerr)**: Approve/Decline requests directly from notifications
  - Toast notifications with Approve/Decline buttons for pending requests
  - Notification Center also shows action buttons
  - Auto-dismiss after 10 seconds with hover-pause
  - Click toast body to open Notification Center
  - Swipe-to-dismiss gesture on toast notifications
- **Cross-Device Notification Sync**: Real-time sync across all connected devices
  - Read, delete, mark all read, clear all actions sync via SSE
  - Toasts dismissed when notification deleted on another device
- **Push Notification Click Toast Reshow**: Click web push to show/reset toast
  - Service Worker posts message to open app tabs
  - If toast visible, resets 10-second timer
  - If toast expired, recreates toast with full functionality
  - Works with app already open or newly opened from notification
- **Dynamic PWA Manifest**: App name and icons now dynamically served via `/api/config/manifest.json`
  - Uses admin-configured app name from systemConfig
  - Icons automatically use custom favicon if uploaded, otherwise default Framerr icons
  - Fallback middleware on `/favicon` route: tries custom â†’ default
  - Service Worker notification icons use same fallback mechanism

## UI/UX Improvements

- **Notification Settings Page**: Aligned styling with IntegrationsSettings (glass-subtle cards, lucide-react icons, consistent toggle switches)
- **Integration Cards Standardization**: All integration cards now match System Health design pattern
- **Dashboard Edit Button**: Hidden when grid in sm breakpoint (not just when viewport < md)
- **Grid Breakpoints Simplified**: Reduced to 2 breakpoints (lg â‰¥768px, sm <768px) aligned with sidebar threshold
- **Debug Overlay v2.0**: Added Layout Controller section showing mode, isMobile, viewport width, threshold with visual indicator
- **Dashboard Bottom Padding**: Fixed to use 16px bottom spacer matching sidebar/tabbar margin from screen edge
- **Settings Page Headers Standardized**: Centered headers with consistent styling (text-2xl md:text-3xl) across all 11 settings pages
- **Mobile Scroll Containment**: Added global page lock (`overflow-x: hidden`, `overscroll-behavior-x: none`) for native app-like feel
- **Settings Sub-Tab Scroll**: All settings sub-tabs now use `scroll-contain-x` to prevent horizontal scroll bubbling
- **Widgets Page Mobile Responsiveness**: Comprehensive mobile refinements:
  - ActiveWidgets: Stats cards inline (3-col: Total/Types/Avg Size), info row wraps, compact IconPicker on mobile
  - IntegrationsSettings: Service description hidden on mobile, configured badge shows emoji-only (ðŸŸ¢/ðŸŸ¡)
  - SharedWidgets: Revoke Access button shows trash icon only on mobile
  - LinkedAccounts: Plex SSO card stacks vertically, smaller padding/text on mobile
  - Test buttons show inline result (icon changes, text hidden on mobile)
- **IconPicker Responsive Sizing**: Popover uses `calc(100vw - 48px)` on mobile with 280px min, appears above modals (z-60)
- **Settings Tab Auto-Scroll**: Clicking or deep-linking to a settings tab automatically scrolls the tab bar to center the active tab
  - Works on main settings tabs and all sub-tabs (Integrations, Customization, Auth, Advanced)
  - 50ms delay ensures DOM is ready on initial navigation
- **Mobile Tab Bar Touch Optimization**: Removed hover effects from bottom tab bar
  - Replaced `hover:` with `active:` for native touch feedback
  - Removed sliding indicator hover preview (shows only on active tab)

## Bug Fixes

- **Test Notification Double Toast**: Fixed test notification button showing 2 toasts (removed manual toast since SSE handles it)
- **User Deletion "Not Found" Error**: Fixed `deleteUser` function to return boolean indicating success
- **Profile Picture Reactivity**: Profile picture now updates immediately in sidebar after upload/remove without page refresh
- **Profile Picture Cache-Busting**: Added timestamps to prevent stale cached images showing after upload
- **Dynamic Upload Button**: Upload button now shows "Upload Photo" (no picture) or "Change Photo" (has picture)
- **Unknown Group Warning**: Fixed group lookup in permissions.js to handle array format correctly
- **Scroll Position Bleeding**: Each page now has independent scroll container (Dashboard, Settings, Tabs)
- **Dashboard Greeting Reactivity**: Greeting now updates in Dashboard immediately after saving in settings
- **Default Application Name**: Changed default from "Homelab Dashboard" to "Framerr"
- **Test Notification Card Border**: Fixed white/info border to use theme-compliant styling
- **Breakpoint Thrashing**: FIXED - Eliminated mismatch between viewport-based (Tailwind/Sidebar) and container-based (react-grid-layout) breakpoint decisions via Layout Controller
- **Sidebar Text Fade in Notification Center**: Fixed sidebar footer labels (Back to Tabs, Profile) staying visible when mouse leaves sidebar while notification center is open
- **Sidebar Collapse After Notification Close**: Fixed sidebar now properly collapses when notification center is closed via X button or backdrop click
- **403 Errors for Non-Admin Users**: Fixed excessive 403 errors flooding console when non-admin users access the app
  - Added `isAdmin` checks to SystemConfigContext, AppDataContext, Dashboard, CustomizationSettings
  - Non-admins now skip admin-only API calls entirely instead of getting 403 errors
- **App Branding Sync for Non-Admins**: Non-admin users now see correct admin-configured app name/icon in sidebar
  - Created public `/api/config/app-name` endpoint returning name and icon
  - AppDataContext fetches branding from public endpoint for all users
- **Customization Settings Access Control**: Hidden admin-only sections for non-admin users
  - Application Branding section hidden for non-admins
  - Favicon subtab hidden for non-admins
- **Widget Error Messages Differentiation**: Non-admin users now see "Access Not Available" instead of "Integration Disabled"
  - Admins see "Integration Disabled" with link to settings (actionable)
  - Non-admins see "Access Not Available" with friendly message (not actionable)
  - Updated 6 widgets: Sonarr, Radarr, Plex, qBittorrent, Overseerr, System Health
- **Shared Integration Access for Non-Admins**: Non-admin users now properly load shared integrations
  - AppDataContext fetches from `/api/integrations/shared` for non-admin users
  - Widgets now work correctly when admin shares integration access
  - Added token field to shared endpoint for Plex compatibility
- **Proper Integration Access Revocation**: Widgets now ONLY use context for credentials
  - Removed config fallback that was bypassing access control
  - When access is revoked, widgets immediately lose credentials
  - Consistent pattern for all 6 widgets
- **FaviconInjector Log Level**: Changed INFO logs to DEBUG level
- **Calendar Widget No-Access Handling**: Calendar now uses AppDataContext for integrations like other widgets
  - Shows IntegrationNoAccessMessage for non-admins when no access
  - Shows IntegrationDisabledMessage for admins when not configured
- **SystemStatus Integration Badge**: Fixed badge detection in WidgetGallery and AddWidgetModal
  - Now correctly checks `backend` + `glances.url` or `custom.url` instead of just `url`
- **Linked Accounts API**: New `GET /api/linked-accounts/me` endpoint for fetching database-stored linked accounts
- **Plex SSO Status Display**: LinkedAccountsSettings now shows Plex SSO link status (read-only)
- **Safari Web Push Not Working (CRITICAL)**: Fixed push notifications failing silently on Safari/iOS
  - Changed VAPID subject from `.local` domain to valid `.app` domain
  - Safari rejects JWT tokens with `.local` domains causing `BadJwtToken` errors
  - Separated manifest icon `purpose` into individual entries (`any` and `maskable` separate)
  - Simplified Service Worker push handler to match Overseerr's working pattern
- **Push Subscription Device Matching**: Fixed unreliable device matching for enable/disable
  - Server now returns endpoint in subscription list for reliable client-side matching
  - Fixed `unsubscribeFromPush` to use exact endpoint comparison instead of broken ID check
  - Fixed `removePushSubscription` to properly set `pushEnabled=false` when THIS device is removed
  - Added "This Device" badge in subscription list with accent styling
- **Plex SSO Library Access Check**: Fixed friends without library access being able to log in
  - Changed from `/api/users` (returns ALL friends) to `/api/v2/shared_servers/{machineId}`
  - New endpoint returns ONLY users with actual library sharing access on the specific server
  - Uses `invitedId` field for accurate user matching
- **iOS Mobile Scroll/Zoom Fix**: Fixed content not scrolling to full top/bottom on iOS Safari
  - Root cause: `h-screen` (100vh) uses maximum viewport height, not current visible area
  - Solution: `100dvh` (dynamic viewport height) that adapts to iOS toolbar state
  - Added `viewport-fit=cover` + `maximum-scale=1.0, user-scalable=no` for zoom prevention
  - Added safe-area-inset padding for notch/home indicator handling
  - Added `min-h-0 h-full` on main for Safari flexbox height calculation fix
- **Widget Loading Race Condition**: Fixed "Integration Disabled" message showing before data loads
  - Added `integrationsLoaded` and `integrationsError` states to AppDataContext
  - All 7 integration widgets now wait for integrations to load before checking status
  - New `IntegrationConnectionError` component for network failures
  - Widgets show loading spinner â†’ actual status (not premature "disabled" message)
- **Session Expiry Auto-Redirect**: User now auto-redirected to login when session expires
  - Axios interceptor triggers logout on 401 errors
  - Visibility change listener checks auth when tab wakes from sleep
  - "Session Expired" toast followed by immediate redirect to /login
  - No more stale/broken dashboard visible after timeout
- **Dashboard Loading Indicator**: Fixed off-center and duplicate loading indicators
  - Removed duplicate overflowY from DashboardOrTabs
  - Dashboard loading state is now invisible placeholder (prevents layout shift)
  - ProtectedRoute loading uses same spinner style
- **Clock Widget Layout**: Improved text alignment in both vertical and horizontal modes
  - Larger time display (5xl), centered date, grouped edit controls
  - Horizontal mode threshold changed from 280px to 410px
- **Weather Widget Layout**: Improved visual hierarchy and text display
  - Vertical: temp + icon side by side, location above, conditions below
  - Horizontal: icon â†’ temp â†’ info column layout
  - Removed location text truncation (shows full text, wraps if needed)
  - Min height reduced to h:1 for compact horizontal mode

### Plex SSO Authentication System
- **Plex SSO Configuration Persistence**: Fixed SSO settings not persisting after OAuth flow and page refresh
  - Added `plexSSO` key handling in `systemConfig.js` for database persistence
  - Fixed `updateSystemConfig` calls in `plex.js` to use object syntax
- **Plex User Verification**: Fixed library access verification to check correct user list
  - Changed from `/api/v2/friends` (social) to `/api/users` (library access)
  - Added XML parsing with `xml2js` for Plex API responses
- **Plex Admin User Mapping**: Plex admin now correctly maps to linked Framerr user
  - Uses `linkedUserId` from SSO config when Plex admin logs in
- **Plex SSO Login UX**: Improved login flow for Safari compatibility
  - Changed from popup to full page redirect
  - Stores PIN in localStorage for redirect callback
- **Plex Server List**: Server list now persists on page refresh
  - Added `/api/plex/admin-resources` endpoint for retrieving servers
- **Admin User Linking**: Added dropdown to link Plex account to Framerr admin user

## Changes

- **Application Branding UI**: Merged application name and icon sections into single "Application Branding" section
- **Axios Interceptor**: Added global axios response interceptor for 401 error handling
- **Breakpoint Architecture**: Moved from mixed Tailwind/local state to unified LayoutContext

---

## Files Added
- `src/utils/axiosSetup.js` - Axios interceptor for global 401 handling
- `src/constants/layout.js` - Layout constants (MOBILE_THRESHOLD, SIDEBAR_WIDTH, TABBAR_HEIGHT)
- `src/context/LayoutContext.jsx` - Layout Controller with debounced resize, SSR-safe
- `server/routes/linkedAccounts.js` - API for fetching user's database-stored linked accounts
- `docs/reference/notifications.md` - Integration notifications architecture documentation
- `src/constants/notificationEvents.js` - Event definitions for Overseerr/Sonarr/Radarr (36 total)
- `src/components/settings/EventSelectDropdown.jsx` - Multi-select dropdown with Select All/None
- `server/routes/webhooks.js` - Webhook receiver endpoints for Overseerr/Sonarr/Radarr
- `server/services/webhookUserResolver.js` - User resolution cascade for webhook notifications
- `server/services/notificationEmitter.js` - SSE event emitter for real-time notification broadcast

## Files Modified This Session
- `App.jsx` - Wrapped with LayoutProvider, inline styles from context
- `Sidebar.jsx` - Uses isMobile from LayoutContext
- `Dashboard.jsx` - Forces sm layout when mobile, edit button based on effectiveBreakpoint
- `DebugOverlay.jsx` - Added Layout Controller info section (v2.0)

## Components Updated with Notifications
- UsersSettings.jsx, ProfileSettings.jsx, CustomizationSettings.jsx
- TabGroupsSettings.jsx, PermissionGroupsSettings.jsx, UserTabsSettings.jsx
- LinkGridWidget_v2.jsx, ActiveWidgets.jsx, Login.jsx, Sidebar.jsx

---

**Known Issues:**
- Logout toast not displaying on login page (needs investigation)
- Widget animation on navigation (react-grid-layout re-measuring) - left as-is

