# v1.2.1

**Status:** RELEASED
**Date:** 2025-12-19

---

## Bug Fixes

### Critical: Auth Proxy Logout

Fixed logout flow when using Authentik (or other auth proxy) that was causing CORS errors and broken redirects.

**Root Cause:** Service Worker was caching the app shell (index.html) and serving it even after logout, bypassing nginx's auth_request which should redirect to Authentik login.

**Solution:**
1. Service Worker now skips cache for navigation requests (`mode === 'navigate'`)
2. Logout uses browser-native HTTP 302 redirect instead of async JavaScript
3. Server GET `/api/auth/logout` endpoint for browser-native logout

### Other Fixes
- Re-enabled Plex SSO status check on login page (safe with SW fix)
- Cleaned up debug logging

---

## Files Modified

- `public/sw.js` - Skip cache for navigation requests, bump to v1.2.1
- `server/routes/auth.js` - Add GET logout endpoint with 302 redirect
- `src/context/AuthContext.jsx` - Simplified logout to use browser navigation
- `src/components/Sidebar.jsx` - Use window.location.href for logout
- `src/pages/Login.jsx` - Re-enabled Plex SSO check

## Files Added

- `docs/secondopinion/organizr-auth-analysis.md` - Deep dive into Organizr's auth implementation

---

## Technical Details

The fix ensures logout works seamlessly with auth proxy setups:

1. User clicks logout
2. Browser navigates to `/api/auth/logout` (full page, not XHR)
3. Server clears session cookie
4. Server returns HTTP 302 to `/outpost.goauthentik.io/sign_out`
5. Browser follows redirect (no JavaScript involved)
6. Authentik processes logout and redirects to login

This matches how Organizr and other PHP apps handle auth proxy logout - letting the browser handle redirects instead of JavaScript.
