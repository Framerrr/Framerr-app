# Framerr v1.3.2 - DRAFT

**Status:** DRAFT  
**Target Release:** TBD

---

## Features

### Dashboard Template System (WIP)
- **Template Builder** - 3-step wizard for creating dashboard templates
  - Step 1: Name, description, category
  - Step 2: Grid editor with full drag/resize, undo/redo support
  - Step 3: Review and save (includes "Save & Share" button for admins)
- **Template List** - View, apply, edit, duplicate, delete templates
  - Category filter dropdown
  - Template preview modal with desktop/mobile toggle
  - Compact badges: "by username", "with N", pulsing "Update" badge
  - Category shown under template name with tag icon
- **Template Thumbnails** - Mini preview of template grid layout
- **Mock Widgets** - Static widget replicas for template previews
- **Apply Template** - Replaces dashboard with template widgets
- **Backup/Revert** - Auto-backup before apply, restore previous dashboard
- **Widget Config Preservation** - Templates save showHeader, flatten, and other settings
- **Template Sharing (Admin)** - User copy model:
  - Sharing creates individual copies for each user
  - User edits only affect their copy (isolation)
  - "Sync" button to pull admin updates
  - "Revert" button to restore shared version
  - Admin sees "Shared with N" badge showing share count

### Database-Backed Integration Sharing
- New `integration_shares` table for persistent sharing
- API endpoints: `POST/DELETE/GET /api/integrations/:name/share`
- `GET /api/integrations/all-shares` for admin overview
- Backwards compatible with config-based sharing during migration

### Default Template for New Users
- Admin can mark a template as "default for new users"
- Automatically shared and applied when new users are created
- Required integrations auto-shared with new users
- UI messaging explaining the behavior in template builder

### Theme-Aware Edit Mode Colors
- Dashboard edit mode (borders, placeholder, resize handles, mobile hold-to-drag) now uses theme-appropriate colors
- Each theme has distinct edit mode accent:
  - Dark Pro: Blue 400
  - Light: Blue 600 (darker for visibility on white)
  - Dracula: Pink (theme signature)
  - Nord: Frost 3 (deeper frost blue)
  - Nebula: Cyan 400 (contrasts purple bg)
  - Noir: Silver Light (visible on black)
  - Catppuccin: Sapphire (theme bright blue)

### Theme-Aware Splash Screen
- Instant theme-colored splash screen prevents "flash of wrong theme" (FOUC)
- Splash uses inline CSS with theme color mappings before React loads
- Fades out smoothly once authentication completes

### Admin Theme on Login Page
- New public `/api/theme/default` endpoint returns admin's selected theme
- Login page automatically applies admin's theme for consistent branding

### Goodbye Toast on Logout
- Shows "Goodbye! See you soon." toast when user clicks logout
- 500ms delay allows user to see toast before redirect

### Navigation Scroll-to-Top (Mobile)
- Dashboard button re-tap scrolls to top when already on dashboard
- Tapping the top safe area (notch blur) scrolls page to top
- Works on both desktop and mobile sidebar

---

## Bug Fixes

### Template System Fixes
- Fixed 404 on `/api/templates/categories` - route order in Express
- Fixed state caching in Template Builder when reopening modal
- Fixed widget display after template apply - missing root-level fields
- Fixed widget titles showing "Widget" - now uses metadata name fallback
- Fixed grid not scrollable in Step 2
- **Fixed default template checkbox not persisting when editing templates**

### Integration Sharing Dropdown Fixes
- **SharingDropdown now aligns with TemplateSharingDropdown UX:**
  - Explicit Save/Cancel buttons (no immediate API calls)
  - Shows user list in Everyone mode (all checked)
  - Auto-switch to per-user mode when deselecting
  - Auto-switch to Everyone when all users selected
  - Proper `hasChanges` detection for Save button state

### Tab Iframe Loading Theme
- Tab loading spinner now uses theme variables instead of hardcoded slate colors
- Properly adapts to all themes

### Toast Safe Area on Mobile
- Toast notifications now respect iOS safe area inset (notch)
- Uses `env(safe-area-inset-top)` for proper positioning

### Widget Popovers in Edit Mode
- Widget popovers no longer open when dashboard is in edit mode
- Affected: Sonarr, Radarr, qBittorrent, Calendar, System Status widgets
- Uses `useEditModeAware` hook to block opening during drag/resize operations

### Popover UX Refinements
- Reduced popover gap from 8px to 4px (closer to trigger)
- Removed popover arrow pointers for cleaner flat design
- Popovers now close automatically when scrolling main content
- New `useCloseOnScroll` hook for consistent scroll-close behavior

### Scroll Behavior Consistency
- Removed widget-content scrollbar override from `GridLayout.css`
- All widgets now follow global scrollbar hiding for consistent clean UI

---

## Technical Changes

### Widget-Integration Mapping Centralized
- **New shared module:** `shared/widgetIntegrations.ts`
- Single source of truth for widget â†’ integration mapping
- Removed hardcoded maps from 4 locations (users.ts, templates.ts x2)
- Removed inactive integrations (sabnzbd, upcomingmedia)

### Template Engine Infrastructure
- New database tables: `dashboard_templates`, `template_categories`, `template_shares`, `dashboard_backups`
- New API routes: 15+ endpoints for template CRUD, categories, sharing, backups
- New components: `TemplateBuilder`, `TemplateList`, `TemplateCard`
- Widget config now preserved in templates (showHeader, flatten, etc.)

### CSS Variables Added to All Themes
- `--accent-edit`: Primary edit mode accent color
- `--accent-edit-soft`: Semi-transparent edit accent (for borders)
- `--scrollbar-thumb`: Theme-aware scrollbar thumb (future use)
- `--scrollbar-track`: Theme-aware scrollbar track (future use)

### CSS Specificity Fixes
- Fixed RGL placeholder using more specific selector to override default red
- Removed duplicate CSS variable fallback from `design-system.css`
- Removed hardcoded inline border styles from Dashboard components

### Splash Screen Infrastructure
- Inline critical CSS in `index.html` with theme color mappings
- `themeColors` object maps theme names to splash colors (bg, text, accent)
- When adding new themes, must update both theme CSS and `index.html`


